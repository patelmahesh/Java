/*
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */
package com.panthera.utility;

import com.mxgraph.canvas.mxGraphicsCanvas2D;
import com.mxgraph.reader.mxSaxOutputHandler;
import com.mxgraph.util.mxUtils;
import java.awt.Color;
import java.awt.Graphics2D;
import java.awt.image.BufferedImage;
import java.io.ByteArrayOutputStream;
import java.io.File;
import java.io.FileNotFoundException;
import java.io.FileOutputStream;
import java.io.IOException;
import java.io.StringReader;
import javax.imageio.ImageIO;
import javax.xml.parsers.ParserConfigurationException;
import javax.xml.parsers.SAXParserFactory;
import org.xml.sax.InputSource;
import org.xml.sax.SAXException;
import org.xml.sax.XMLReader;

/**
 *
 * @author dpimac
 * 
 */
public class ServeletImage {

    private static transient SAXParserFactory parserFactory = SAXParserFactory.newInstance();

    public static void main(String[] args) throws FileNotFoundException, SAXException, ParserConfigurationException {
     String xml = "<mxGraphModel dx=\"1604\" dy=\"474\" grid=\"1\" gridSize=\"10\" guides=\"1\" tooltips=\"1\" connect=\"1\" arrows=\"1\" fold=\"1\" page=\"1\" pageScale=\"1\" pageWidth=\"850\" pageHeight=\"1100\" background=\"#ffffff\"><root><mxCell id=\"0\"/><mxCell id=\"1\" parent=\"0\"/><mxCell id=\"82\" value=\"\" style=\"shape=process;whiteSpace=wrap;html=1;size=0.20578507352466427;\" parent=\"1\" vertex=\"1\"><mxGeometry x=\"27\" y=\"506\" width=\"242\" height=\"60\" as=\"geometry\"/></mxCell><mxCell id=\"60\" value=\"\" style=\"shape=process;whiteSpace=wrap;html=1;size=0.20578507352466427;\" parent=\"1\" vertex=\"1\"><mxGeometry x=\"29\" y=\"412\" width=\"242\" height=\"60\" as=\"geometry\"/></mxCell><mxCell id=\"14\" style=\"edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;exitX=0.5;exitY=1;jettySize=auto;orthogonalLoop=1;\" parent=\"1\" source=\"8\" edge=\"1\"><mxGeometry relative=\"1\" as=\"geometry\"><mxPoint x=\"473\" y=\"207\" as=\"targetPoint\"/></mxGeometry></mxCell><mxCell id=\"16\" style=\"edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;exitX=0;exitY=0.5;jettySize=auto;orthogonalLoop=1;\" parent=\"1\" source=\"8\" edge=\"1\"><mxGeometry relative=\"1\" as=\"geometry\"><mxPoint x=\"213\" y=\"137\" as=\"targetPoint\"/></mxGeometry></mxCell><mxCell id=\"8\" value=\"\" style=\"ellipse;whiteSpace=wrap;html=1;\" parent=\"1\" vertex=\"1\"><mxGeometry x=\"323\" y=\"97\" width=\"300\" height=\"80\" as=\"geometry\"/></mxCell><mxCell id=\"9\" value=\"\" style=\"endArrow=none;html=1;exitX=0.797;exitY=0.91;exitPerimeter=0;\" parent=\"1\" source=\"8\" edge=\"1\"><mxGeometry width=\"50\" height=\"50\" relative=\"1\" as=\"geometry\"><mxPoint x=\"563\" y=\"167\" as=\"sourcePoint\"/><mxPoint x=\"563\" y=\"107\" as=\"targetPoint\"/></mxGeometry></mxCell><mxCell id=\"10\" value=\"\" style=\"endArrow=none;html=1;\" parent=\"1\" edge=\"1\"><mxGeometry width=\"50\" height=\"50\" relative=\"1\" as=\"geometry\"><mxPoint x=\"384\" y=\"167\" as=\"sourcePoint\"/><mxPoint x=\"384\" y=\"107\" as=\"targetPoint\"/></mxGeometry></mxCell><mxCell id=\"11\" value=\"&lt;font style=&quot;font-size: 14px&quot;&gt;&lt;b&gt;1&lt;/b&gt;&lt;/font&gt;\" style=\"text;html=1;resizable=0;points=[];autosize=1;align=left;verticalAlign=top;spacingTop=-4;\" parent=\"1\" vertex=\"1\"><mxGeometry x=\"580\" y=\"130\" width=\"20\" height=\"20\" as=\"geometry\"/></mxCell><mxCell id=\"12\" value=\"ق . ت . ع\" style=\"text;html=1;resizable=0;points=[];autosize=1;align=left;verticalAlign=top;spacingTop=-4;\" parent=\"1\" vertex=\"1\"><mxGeometry x=\"333\" y=\"128\" width=\"60\" height=\"20\" as=\"geometry\"/></mxCell><mxCell id=\"114\" value=\"\" style=\"edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;jettySize=auto;orthogonalLoop=1;\" parent=\"1\" source=\"13\" target=\"113\" edge=\"1\"><mxGeometry relative=\"1\" as=\"geometry\"/></mxCell><mxCell id=\"13\" value=\"&lt;div style=&quot;text-align: center&quot;&gt;&lt;span&gt;استلام الاسماء وارسال التعاميم&amp;nbsp;&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;text-align: center&quot;&gt;بالاسماء بشكل ربع سنوي&lt;/div&gt;\" style=\"text;html=1;resizable=0;points=[];autosize=1;align=left;verticalAlign=top;spacingTop=-4;\" parent=\"1\" vertex=\"1\"><mxGeometry x=\"407\" y=\"123\" width=\"140\" height=\"30\" as=\"geometry\"/></mxCell><mxCell id=\"113\" value=\"&lt;div style=&quot;text-align: center&quot;&gt;&lt;span&gt;استلام الاسماء وارسال التعاميم&amp;nbsp;&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;text-align: center&quot;&gt;بالاسماء بشكل ربع سنوي&lt;/div&gt;\" style=\"text;html=1;resizable=0;points=[];autosize=1;align=left;verticalAlign=top;spacingTop=-4;\" parent=\"1\" vertex=\"1\"><mxGeometry x=\"627\" y=\"123\" width=\"140\" height=\"30\" as=\"geometry\"/></mxCell><mxCell id=\"17\" value=\"\" style=\"endArrow=none;html=1;\" parent=\"1\" edge=\"1\"><mxGeometry width=\"50\" height=\"50\" relative=\"1\" as=\"geometry\"><mxPoint x=\"287\" y=\"138\" as=\"sourcePoint\"/><mxPoint x=\"287\" y=\"77\" as=\"targetPoint\"/></mxGeometry></mxCell><mxCell id=\"18\" value=\"\" style=\"shape=cylinder;whiteSpace=wrap;html=1;boundedLbl=1;\" parent=\"1\" vertex=\"1\"><mxGeometry x=\"247\" y=\"4\" width=\"80\" height=\"70\" as=\"geometry\"/></mxCell><mxCell id=\"19\" value=\"التراسل الالكتروني\" style=\"text;html=1;resizable=0;points=[];autosize=1;align=left;verticalAlign=top;spacingTop=-4;\" parent=\"1\" vertex=\"1\"><mxGeometry x=\"249\" y=\"38\" width=\"90\" height=\"20\" as=\"geometry\"/></mxCell><mxCell id=\"20\" value=\"\" style=\"shape=mxgraph.flowchart.multi-document;whiteSpace=wrap;html=1;fillColor=#ffffff;strokeColor=#000000;strokeWidth=2\" parent=\"1\" vertex=\"1\"><mxGeometry x=\"123\" y=\"108\" width=\"88\" height=\"60\" as=\"geometry\"/></mxCell><mxCell id=\"21\" value=\"&lt;div style=&quot;text-align: center&quot;&gt;&lt;span&gt;كشف الدورات&amp;nbsp;&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;text-align: center&quot;&gt;واسماء التشخيص&lt;/div&gt;\" style=\"text;html=1;resizable=0;points=[];autosize=1;align=left;verticalAlign=top;spacingTop=-4;\" parent=\"1\" vertex=\"1\"><mxGeometry x=\"127\" y=\"122\" width=\"80\" height=\"30\" as=\"geometry\"/></mxCell><mxCell id=\"22\" style=\"edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;exitX=0;exitY=0.5;jettySize=auto;orthogonalLoop=1;\" parent=\"1\" edge=\"1\"><mxGeometry relative=\"1\" as=\"geometry\"><mxPoint x=\"623\" y=\"138\" as=\"targetPoint\"/><mxPoint x=\"733\" y=\"138\" as=\"sourcePoint\"/></mxGeometry></mxCell><mxCell id=\"23\" value=\"\" style=\"endArrow=none;html=1;\" parent=\"1\" edge=\"1\"><mxGeometry width=\"50\" height=\"50\" relative=\"1\" as=\"geometry\"><mxPoint x=\"695\" y=\"138\" as=\"sourcePoint\"/><mxPoint x=\"695\" y=\"77\" as=\"targetPoint\"/></mxGeometry></mxCell><mxCell id=\"24\" value=\"\" style=\"shape=cylinder;whiteSpace=wrap;html=1;boundedLbl=1;\" parent=\"1\" vertex=\"1\"><mxGeometry x=\"656\" y=\"4\" width=\"80\" height=\"70\" as=\"geometry\"/></mxCell><mxCell id=\"25\" value=\"التراسل الالكتروني\" style=\"text;html=1;resizable=0;points=[];autosize=1;align=left;verticalAlign=top;spacingTop=-4;\" parent=\"1\" vertex=\"1\"><mxGeometry x=\"658\" y=\"38\" width=\"90\" height=\"20\" as=\"geometry\"/></mxCell><mxCell id=\"26\" value=\"\" style=\"shape=mxgraph.flowchart.multi-document;whiteSpace=wrap;html=1;fillColor=#ffffff;strokeColor=#000000;strokeWidth=2\" parent=\"1\" vertex=\"1\"><mxGeometry x=\"736\" y=\"97\" width=\"88\" height=\"60\" as=\"geometry\"/></mxCell><mxCell id=\"27\" value=\"&lt;div style=&quot;text-align: center&quot;&gt;&lt;span&gt;كشف الدورات&amp;nbsp;&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;text-align: center&quot;&gt;واسماء التشخيص&lt;/div&gt;\" style=\"text;html=1;resizable=0;points=[];autosize=1;align=left;verticalAlign=top;spacingTop=-4;\" parent=\"1\" vertex=\"1\"><mxGeometry x=\"740\" y=\"111\" width=\"80\" height=\"30\" as=\"geometry\"/></mxCell><mxCell id=\"35\" style=\"edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;exitX=0.5;exitY=1;jettySize=auto;orthogonalLoop=1;\" parent=\"1\" source=\"29\" edge=\"1\"><mxGeometry relative=\"1\" as=\"geometry\"><mxPoint x=\"468\" y=\"307\" as=\"targetPoint\"/></mxGeometry></mxCell><mxCell id=\"29\" value=\"\" style=\"shape=process;whiteSpace=wrap;html=1;size=0.17407407407407408;\" parent=\"1\" vertex=\"1\"><mxGeometry x=\"323\" y=\"217\" width=\"289\" height=\"60\" as=\"geometry\"/></mxCell><mxCell id=\"30\" value=\"\" style=\"endArrow=none;html=1;exitX=0;exitY=0.5;\" parent=\"1\" source=\"29\" edge=\"1\"><mxGeometry width=\"50\" height=\"50\" relative=\"1\" as=\"geometry\"><mxPoint x=\"342\" y=\"247\" as=\"sourcePoint\"/><mxPoint x=\"372\" y=\"247\" as=\"targetPoint\"/></mxGeometry></mxCell><mxCell id=\"31\" value=\"ق . ت . ع\" style=\"text;html=1;resizable=0;points=[];autosize=1;align=left;verticalAlign=top;spacingTop=-4;\" parent=\"1\" vertex=\"1\"><mxGeometry x=\"324\" y=\"226\" width=\"60\" height=\"20\" as=\"geometry\"/></mxCell><mxCell id=\"32\" value=\"&lt;font style=&quot;font-size: 14px&quot;&gt;&lt;b&gt;2&lt;/b&gt;&lt;/font&gt;\" style=\"text;html=1;resizable=0;points=[];autosize=1;align=left;verticalAlign=top;spacingTop=-4;\" parent=\"1\" vertex=\"1\"><mxGeometry x=\"580\" y=\"237\" width=\"20\" height=\"20\" as=\"geometry\"/></mxCell><mxCell id=\"34\" value=\"&lt;div style=&quot;text-align: center&quot;&gt;استلام ورصد اسماء المنتسبين&lt;/div&gt;&lt;div style=&quot;text-align: center&quot;&gt;الاضافة / الاستبدال / الغاء&lt;/div&gt;\" style=\"text;html=1;resizable=0;points=[];autosize=1;align=left;verticalAlign=top;spacingTop=-4;\" parent=\"1\" vertex=\"1\"><mxGeometry x=\"403\" y=\"236\" width=\"130\" height=\"30\" as=\"geometry\"/></mxCell><mxCell id=\"36\" style=\"edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;exitX=0.5;exitY=1;jettySize=auto;orthogonalLoop=1;\" parent=\"1\" source=\"37\" edge=\"1\"><mxGeometry relative=\"1\" as=\"geometry\"><mxPoint x=\"466\" y=\"407\" as=\"targetPoint\"/></mxGeometry></mxCell><mxCell id=\"37\" value=\"\" style=\"shape=process;whiteSpace=wrap;html=1;size=0.17407407407407408;\" parent=\"1\" vertex=\"1\"><mxGeometry x=\"321\" y=\"317\" width=\"289\" height=\"60\" as=\"geometry\"/></mxCell><mxCell id=\"38\" value=\"\" style=\"endArrow=none;html=1;exitX=0;exitY=0.5;\" parent=\"1\" source=\"37\" edge=\"1\"><mxGeometry width=\"50\" height=\"50\" relative=\"1\" as=\"geometry\"><mxPoint x=\"340\" y=\"347\" as=\"sourcePoint\"/><mxPoint x=\"370\" y=\"347\" as=\"targetPoint\"/></mxGeometry></mxCell><mxCell id=\"39\" value=\"ق . ت . ع\" style=\"text;html=1;resizable=0;points=[];autosize=1;align=left;verticalAlign=top;spacingTop=-4;\" parent=\"1\" vertex=\"1\"><mxGeometry x=\"322\" y=\"326\" width=\"60\" height=\"20\" as=\"geometry\"/></mxCell><mxCell id=\"40\" value=\"&lt;font style=&quot;font-size: 14px&quot;&gt;&lt;b&gt;3&lt;/b&gt;&lt;/font&gt;\" style=\"text;html=1;resizable=0;points=[];autosize=1;align=left;verticalAlign=top;spacingTop=-4;\" parent=\"1\" vertex=\"1\"><mxGeometry x=\"578\" y=\"337\" width=\"20\" height=\"20\" as=\"geometry\"/></mxCell><mxCell id=\"41\" value=\"&lt;div style=&quot;text-align: center&quot;&gt;التدقيق من نصاب الدورة مكتمل&lt;/div&gt;\" style=\"text;html=1;resizable=0;points=[];autosize=1;align=left;verticalAlign=top;spacingTop=-4;\" parent=\"1\" vertex=\"1\"><mxGeometry x=\"401\" y=\"336\" width=\"140\" height=\"20\" as=\"geometry\"/></mxCell><mxCell id=\"42\" style=\"edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;jettySize=auto;orthogonalLoop=1;\" parent=\"1\" edge=\"1\"><mxGeometry relative=\"1\" as=\"geometry\"><mxPoint x=\"612\" y=\"246\" as=\"targetPoint\"/><mxPoint x=\"653\" y=\"246\" as=\"sourcePoint\"/></mxGeometry></mxCell><mxCell id=\"43\" value=\"\" style=\"shape=cylinder;whiteSpace=wrap;html=1;boundedLbl=1;\" parent=\"1\" vertex=\"1\"><mxGeometry x=\"655\" y=\"202\" width=\"80\" height=\"70\" as=\"geometry\"/></mxCell><mxCell id=\"44\" value=\"التراسل الالكتروني\" style=\"text;html=1;resizable=0;points=[];autosize=1;align=left;verticalAlign=top;spacingTop=-4;\" parent=\"1\" vertex=\"1\"><mxGeometry x=\"657\" y=\"236\" width=\"90\" height=\"20\" as=\"geometry\"/></mxCell><mxCell id=\"45\" value=\"\" style=\"shape=document;whiteSpace=wrap;html=1;boundedLbl=1;\" parent=\"1\" vertex=\"1\"><mxGeometry x=\"623\" y=\"277\" width=\"80\" height=\"51\" as=\"geometry\"/></mxCell><mxCell id=\"46\" value=\"\" style=\"endArrow=none;html=1;\" parent=\"1\" edge=\"1\"><mxGeometry width=\"50\" height=\"50\" relative=\"1\" as=\"geometry\"><mxPoint x=\"633\" y=\"277\" as=\"sourcePoint\"/><mxPoint x=\"633\" y=\"247\" as=\"targetPoint\"/></mxGeometry></mxCell><mxCell id=\"47\" value=\"كشف الاسماء\" style=\"text;html=1;resizable=0;points=[];autosize=1;align=left;verticalAlign=top;spacingTop=-4;\" parent=\"1\" vertex=\"1\"><mxGeometry x=\"630\" y=\"286\" width=\"70\" height=\"20\" as=\"geometry\"/></mxCell><mxCell id=\"54\" style=\"edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;exitX=0;exitY=0.5;jettySize=auto;orthogonalLoop=1;\" parent=\"1\" source=\"53\" edge=\"1\"><mxGeometry relative=\"1\" as=\"geometry\"><mxPoint x=\"393\" y=\"452\" as=\"targetPoint\"/></mxGeometry></mxCell><mxCell id=\"70\" style=\"edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;exitX=0.5;exitY=1;jettySize=auto;orthogonalLoop=1;\" parent=\"1\" source=\"53\" edge=\"1\"><mxGeometry relative=\"1\" as=\"geometry\"><mxPoint x=\"466\" y=\"567\" as=\"targetPoint\"/></mxGeometry></mxCell><mxCell id=\"53\" value=\"\" style=\"rhombus;whiteSpace=wrap;html=1;\" parent=\"1\" vertex=\"1\"><mxGeometry x=\"426\" y=\"412\" width=\"80\" height=\"80\" as=\"geometry\"/></mxCell><mxCell id=\"56\" style=\"edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;exitX=0;exitY=0.5;jettySize=auto;orthogonalLoop=1;\" parent=\"1\" source=\"55\" edge=\"1\"><mxGeometry relative=\"1\" as=\"geometry\"><mxPoint x=\"273\" y=\"452\" as=\"targetPoint\"/></mxGeometry></mxCell><mxCell id=\"55\" value=\"\" style=\"rhombus;whiteSpace=wrap;html=1;\" parent=\"1\" vertex=\"1\"><mxGeometry x=\"312\" y=\"412\" width=\"80\" height=\"80\" as=\"geometry\"/></mxCell><mxCell id=\"57\" style=\"edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;exitX=0.5;exitY=1;entryX=0.5;entryY=1;jettySize=auto;orthogonalLoop=1;\" parent=\"1\" source=\"55\" target=\"55\" edge=\"1\"><mxGeometry relative=\"1\" as=\"geometry\"/></mxCell><mxCell id=\"58\" value=\"\" style=\"endArrow=none;html=1;\" parent=\"1\" edge=\"1\"><mxGeometry width=\"50\" height=\"50\" relative=\"1\" as=\"geometry\"><mxPoint x=\"352\" y=\"542\" as=\"sourcePoint\"/><mxPoint x=\"352\" y=\"492\" as=\"targetPoint\"/></mxGeometry></mxCell><mxCell id=\"59\" style=\"edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;exitX=0;exitY=0.5;jettySize=auto;orthogonalLoop=1;\" parent=\"1\" edge=\"1\"><mxGeometry relative=\"1\" as=\"geometry\"><mxPoint x=\"273\" y=\"542\" as=\"targetPoint\"/><mxPoint x=\"352\" y=\"542\" as=\"sourcePoint\"/></mxGeometry></mxCell><mxCell id=\"62\" value=\"ق . ت . ع\" style=\"text;html=1;resizable=0;points=[];autosize=1;align=left;verticalAlign=top;spacingTop=-4;\" parent=\"1\" vertex=\"1\"><mxGeometry x=\"31\" y=\"417\" width=\"60\" height=\"20\" as=\"geometry\"/></mxCell><mxCell id=\"63\" value=\"&lt;font style=&quot;font-size: 14px&quot;&gt;&lt;b&gt;3&lt;/b&gt;&lt;/font&gt;\" style=\"text;html=1;resizable=0;points=[];autosize=1;align=left;verticalAlign=top;spacingTop=-4;\" parent=\"1\" vertex=\"1\"><mxGeometry x=\"239\" y=\"531\" width=\"20\" height=\"20\" as=\"geometry\"/></mxCell><mxCell id=\"64\" value=\"&lt;div style=&quot;text-align: center&quot;&gt;التدقيق من نصاب الدورة مكتمل&lt;/div&gt;\" style=\"text;html=1;resizable=0;points=[];autosize=1;align=left;verticalAlign=top;spacingTop=-4;\" parent=\"1\" vertex=\"1\"><mxGeometry x=\"87\" y=\"435\" width=\"140\" height=\"20\" as=\"geometry\"/></mxCell><mxCell id=\"76\" style=\"edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;exitX=0.5;exitY=1;jettySize=auto;orthogonalLoop=1;\" parent=\"1\" source=\"71\" edge=\"1\"><mxGeometry relative=\"1\" as=\"geometry\"><mxPoint x=\"466\" y=\"667\" as=\"targetPoint\"/></mxGeometry></mxCell><mxCell id=\"71\" value=\"\" style=\"shape=process;whiteSpace=wrap;html=1;size=0.17407407407407408;\" parent=\"1\" vertex=\"1\"><mxGeometry x=\"321\" y=\"577\" width=\"289\" height=\"60\" as=\"geometry\"/></mxCell><mxCell id=\"72\" value=\"\" style=\"endArrow=none;html=1;exitX=0;exitY=0.5;\" parent=\"1\" source=\"71\" edge=\"1\"><mxGeometry width=\"50\" height=\"50\" relative=\"1\" as=\"geometry\"><mxPoint x=\"340\" y=\"607\" as=\"sourcePoint\"/><mxPoint x=\"370\" y=\"607\" as=\"targetPoint\"/></mxGeometry></mxCell><mxCell id=\"73\" value=\"ق . ت . ع\" style=\"text;html=1;resizable=0;points=[];autosize=1;align=left;verticalAlign=top;spacingTop=-4;\" parent=\"1\" vertex=\"1\"><mxGeometry x=\"322\" y=\"586\" width=\"60\" height=\"20\" as=\"geometry\"/></mxCell><mxCell id=\"74\" value=\"&lt;font style=&quot;font-size: 14px&quot;&gt;&lt;b&gt;3&lt;/b&gt;&lt;/font&gt;\" style=\"text;html=1;resizable=0;points=[];autosize=1;align=left;verticalAlign=top;spacingTop=-4;\" parent=\"1\" vertex=\"1\"><mxGeometry x=\"578\" y=\"597\" width=\"20\" height=\"20\" as=\"geometry\"/></mxCell><mxCell id=\"75\" value=\"&lt;div style=&quot;text-align: center&quot;&gt;التدقيق من نصاب الدورة مكتمل&lt;/div&gt;\" style=\"text;html=1;resizable=0;points=[];autosize=1;align=left;verticalAlign=top;spacingTop=-4;\" parent=\"1\" vertex=\"1\"><mxGeometry x=\"401\" y=\"596\" width=\"140\" height=\"20\" as=\"geometry\"/></mxCell><mxCell id=\"88\" style=\"edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;exitX=0.5;exitY=1;jettySize=auto;orthogonalLoop=1;\" parent=\"1\" source=\"77\" edge=\"1\"><mxGeometry relative=\"1\" as=\"geometry\"><mxPoint x=\"466\" y=\"770\" as=\"targetPoint\"/></mxGeometry></mxCell><mxCell id=\"77\" value=\"\" style=\"shape=process;whiteSpace=wrap;html=1;size=0.17407407407407408;\" parent=\"1\" vertex=\"1\"><mxGeometry x=\"321\" y=\"676\" width=\"289\" height=\"60\" as=\"geometry\"/></mxCell><mxCell id=\"78\" value=\"\" style=\"endArrow=none;html=1;exitX=0;exitY=0.5;\" parent=\"1\" source=\"77\" edge=\"1\"><mxGeometry width=\"50\" height=\"50\" relative=\"1\" as=\"geometry\"><mxPoint x=\"340\" y=\"706\" as=\"sourcePoint\"/><mxPoint x=\"370\" y=\"706\" as=\"targetPoint\"/></mxGeometry></mxCell><mxCell id=\"79\" value=\"ق . ت . ع\" style=\"text;html=1;resizable=0;points=[];autosize=1;align=left;verticalAlign=top;spacingTop=-4;\" parent=\"1\" vertex=\"1\"><mxGeometry x=\"322\" y=\"685\" width=\"60\" height=\"20\" as=\"geometry\"/></mxCell><mxCell id=\"80\" value=\"&lt;font style=&quot;font-size: 14px&quot;&gt;&lt;b&gt;3&lt;/b&gt;&lt;/font&gt;\" style=\"text;html=1;resizable=0;points=[];autosize=1;align=left;verticalAlign=top;spacingTop=-4;\" parent=\"1\" vertex=\"1\"><mxGeometry x=\"578\" y=\"696\" width=\"20\" height=\"20\" as=\"geometry\"/></mxCell><mxCell id=\"81\" value=\"&lt;div style=&quot;text-align: center&quot;&gt;التدقيق من نصاب الدورة مكتمل&lt;/div&gt;\" style=\"text;html=1;resizable=0;points=[];autosize=1;align=left;verticalAlign=top;spacingTop=-4;\" parent=\"1\" vertex=\"1\"><mxGeometry x=\"401\" y=\"695\" width=\"140\" height=\"20\" as=\"geometry\"/></mxCell><mxCell id=\"83\" value=\"\" style=\"endArrow=none;html=1;exitX=0;exitY=0.5;entryX=0.201;entryY=0.52;entryPerimeter=0;\" parent=\"1\" target=\"82\" edge=\"1\"><mxGeometry width=\"50\" height=\"50\" relative=\"1\" as=\"geometry\"><mxPoint x=\"27\" y=\"537\" as=\"sourcePoint\"/><mxPoint x=\"76\" y=\"539\" as=\"targetPoint\"/></mxGeometry></mxCell><mxCell id=\"84\" value=\"ق . ت . ع\" style=\"text;html=1;resizable=0;points=[];autosize=1;align=left;verticalAlign=top;spacingTop=-4;\" parent=\"1\" vertex=\"1\"><mxGeometry x=\"29\" y=\"511\" width=\"60\" height=\"20\" as=\"geometry\"/></mxCell><mxCell id=\"85\" value=\"&lt;font style=&quot;font-size: 14px&quot;&gt;&lt;b&gt;3&lt;/b&gt;&lt;/font&gt;\" style=\"text;html=1;resizable=0;points=[];autosize=1;align=left;verticalAlign=top;spacingTop=-4;\" parent=\"1\" vertex=\"1\"><mxGeometry x=\"237\" y=\"436\" width=\"20\" height=\"20\" as=\"geometry\"/></mxCell><mxCell id=\"86\" value=\"&lt;div style=&quot;text-align: center&quot;&gt;التدقيق من نصاب الدورة مكتمل&lt;/div&gt;\" style=\"text;html=1;resizable=0;points=[];autosize=1;align=left;verticalAlign=top;spacingTop=-4;\" parent=\"1\" vertex=\"1\"><mxGeometry x=\"87\" y=\"526\" width=\"140\" height=\"20\" as=\"geometry\"/></mxCell><mxCell id=\"87\" value=\"\" style=\"endArrow=none;html=1;exitX=0;exitY=0.5;entryX=0.201;entryY=0.52;entryPerimeter=0;\" parent=\"1\" edge=\"1\"><mxGeometry width=\"50\" height=\"50\" relative=\"1\" as=\"geometry\"><mxPoint x=\"29\" y=\"442\" as=\"sourcePoint\"/><mxPoint x=\"78\" y=\"442\" as=\"targetPoint\"/></mxGeometry></mxCell><mxCell id=\"89\" value=\"\" style=\"shape=process;whiteSpace=wrap;html=1;size=0.17407407407407408;\" parent=\"1\" vertex=\"1\"><mxGeometry x=\"323\" y=\"776\" width=\"289\" height=\"60\" as=\"geometry\"/></mxCell><mxCell id=\"90\" value=\"\" style=\"endArrow=none;html=1;exitX=0;exitY=0.5;\" parent=\"1\" source=\"89\" edge=\"1\"><mxGeometry width=\"50\" height=\"50\" relative=\"1\" as=\"geometry\"><mxPoint x=\"342\" y=\"806\" as=\"sourcePoint\"/><mxPoint x=\"372\" y=\"806\" as=\"targetPoint\"/></mxGeometry></mxCell><mxCell id=\"91\" value=\"ق . ت . ع\" style=\"text;html=1;resizable=0;points=[];autosize=1;align=left;verticalAlign=top;spacingTop=-4;\" parent=\"1\" vertex=\"1\"><mxGeometry x=\"324\" y=\"785\" width=\"60\" height=\"20\" as=\"geometry\"/></mxCell><mxCell id=\"92\" value=\"&lt;font style=&quot;font-size: 14px&quot;&gt;&lt;b&gt;3&lt;/b&gt;&lt;/font&gt;\" style=\"text;html=1;resizable=0;points=[];autosize=1;align=left;verticalAlign=top;spacingTop=-4;\" parent=\"1\" vertex=\"1\"><mxGeometry x=\"580\" y=\"796\" width=\"20\" height=\"20\" as=\"geometry\"/></mxCell><mxCell id=\"93\" value=\"&lt;div style=&quot;text-align: center&quot;&gt;التدقيق من نصاب الدورة مكتمل&lt;/div&gt;\" style=\"text;html=1;resizable=0;points=[];autosize=1;align=left;verticalAlign=top;spacingTop=-4;\" parent=\"1\" vertex=\"1\"><mxGeometry x=\"403\" y=\"795\" width=\"140\" height=\"20\" as=\"geometry\"/></mxCell><mxCell id=\"111\" value=\"\" style=\"ellipse;whiteSpace=wrap;html=1;\" parent=\"1\" vertex=\"1\"><mxGeometry x=\"318\" y=\"870\" width=\"300\" height=\"80\" as=\"geometry\"/></mxCell><mxCell id=\"115\" value=\"\" style=\"endArrow=none;html=1;exitX=0.797;exitY=0.91;exitPerimeter=0;\" parent=\"1\" edge=\"1\"><mxGeometry width=\"50\" height=\"50\" relative=\"1\" as=\"geometry\"><mxPoint x=\"552\" y=\"942\" as=\"sourcePoint\"/><mxPoint x=\"553\" y=\"879\" as=\"targetPoint\"/></mxGeometry></mxCell><mxCell id=\"116\" value=\"&lt;font style=&quot;font-size: 14px&quot;&gt;&lt;b&gt;1&lt;/b&gt;&lt;/font&gt;\" style=\"text;html=1;resizable=0;points=[];autosize=1;align=left;verticalAlign=top;spacingTop=-4;\" parent=\"1\" vertex=\"1\"><mxGeometry x=\"570\" y=\"902\" width=\"20\" height=\"20\" as=\"geometry\"/></mxCell></root></mxGraphModel>";

        FileOutputStream fos = new FileOutputStream(new File("grapgh"));

        try {
            
            if (xml != null) {
                xml = xml.replace("ellipse", "shape=ellipse");
            }
            
            ByteArrayOutputStream bos = new ByteArrayOutputStream();
            
            BufferedImage image = mxUtils.createBufferedImage(500, 400, Color.WHITE);
            
            Graphics2D g2 = image.createGraphics();
            mxUtils.setAntiAlias(g2, true, true);
            mxGraphicsCanvas2D g2c = new mxGraphicsCanvas2D(g2);
            
            XMLReader reader = parserFactory.newSAXParser().getXMLReader();
            reader.setFeature("http://apache.org/xml/features/disallow-doctype-decl", true);
            reader.setFeature("http://apache.org/xml/features/nonvalidating/load-external-dtd", false);
            reader.setFeature("http://xml.org/sax/features/external-general-entities", false);
            reader.setFeature("http://xml.org/sax/features/external-parameter-entities", false);
            reader.setContentHandler(new mxSaxOutputHandler(g2c));
            reader.parse(new InputSource(new StringReader(xml)));

            ImageIO.write(image, "jpg", bos);
            bos.writeTo(fos);
            
            /*    
            
            byte[] imageBytes = bos.toByteArray();
            Base64 base64 = new Base64();
            String imageString = base64.encodeBase64String(imageBytes);
            
            */
            
            bos.close();

        } catch (IOException e) {
            
        }
    }

}
